{"title":"微信小程序登录","date":"2021-11-19T14:30:35.000Z","date_formatted":{"ll":"Nov 19, 2021","L":"11/19/2021","MM-DD":"11-19"},"link":"2021/11/19/微信小程序登录","tags":["微信小程序登录"],"updated":"2022-01-30T06:06:13.884Z","content":"<p>#微信授权登录真是最常见的功能了，今日记录一下学习吧，看似简单其实里面的门道还挺复杂，嘶</p>\n<h2 id=\"说明\">说明<a title=\"#说明\" href=\"#说明\"></a></h2>\n<ol>\n<li>调用 <a href=\"https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html\" target=\"_blank\">wx.login()</a> 获取 <strong>临时登录凭证code</strong> ，并回传到开发者服务器。</li>\n<li>调用 <a href=\"https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/login/auth.code2Session.html\" target=\"_blank\">auth.code2Session</a> 接口，换取 <strong>用户唯一标识 OpenID</strong> 、 用户在微信开放平台帐号下的<strong>唯一标识UnionID</strong>（若当前小程序已绑定到微信开放平台帐号） 和 <strong>会话密钥 session_key</strong>。</li>\n</ol>\n<p>之后开发者服务器可以根据用户标识来生成自定义登录态，用于后续业务逻辑中前后端交互时识别用户身份。</p>\n<h2 id=\"注意事项\">注意事项<a title=\"#注意事项\" href=\"#注意事项\"></a></h2>\n<ol>\n<li>会话密钥 <code>session_key</code> 是对用户数据进行 <a href=\"https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html\" target=\"_blank\">加密签名</a> 的密钥。为了应用自身的数据安全，开发者服务器<strong>不应该把会话密钥下发到小程序，也不应该对外提供这个密钥</strong>。</li>\n<li>临时登录凭证 code 只能使用一次</li>\n</ol>\n<p><img src=\"/2021/11/19/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%99%BB%E5%BD%95/C:%5CUsers%5C%E7%88%B1%E6%B5%B7%5Cmyblog%5Csource_posts%5C%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%99%BB%E5%BD%95%5Capi-login.2fcc9f35.jpg\" alt loading=\"lazy\" class=\"φbp\"></p>\n<img src=\"/2021/11/19/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%99%BB%E5%BD%95/api-login.2fcc9f35.jpg\" class title=\"cs\">\n<p>这个图得好好研究。</p>\n<p>简单使用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;button bindtap=<span class=\"string\">&quot;loginHandler&quot;</span>&gt;login&lt;/button&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">  loginHandler:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;</span><br><span class=\"line\">   wx.login(&#123;</span><br><span class=\"line\">     <span class=\"attr\">success</span>:<span class=\"function\">(<span class=\"params\">res</span>)=&gt;</span>&#123;</span><br><span class=\"line\">       <span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125;)</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p>好啦，就酱~</p>\n","prev":{"title":"uni-app基本使用","link":"2021/11/20/uni-app基本使用"},"next":{"title":"小程序真机调试出错In order to be iterable, non-array objects must have a [Symbol.iterator]() method.","link":"2021/11/05/小程序真机调试出错"},"plink":"http://example.com/2021/11/19/微信小程序登录/","toc":[{"id":"说明","title":"说明","index":"1"},{"id":"注意事项","title":"注意事项","index":"2"}],"reading_time":"381 words in 3 min"}