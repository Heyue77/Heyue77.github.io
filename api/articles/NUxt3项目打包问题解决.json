{"title":"Nuxt3项目打包问题解决","slug":"NUxt3项目打包问题解决","date":"2021-11-16T02:58:14.000Z","updated":"2022-02-16T08:32:17.201Z","comments":true,"path":"api/articles/NUxt3项目打包问题解决.json","photos":[],"link":"","excerpt":"最近在开发一个Nuxt3全栈项目，不得不说，坑很多！！还好最后成功打包上线。下面是记录一下项目部署总结","covers":null,"content":"<h2 id=\"最近在开发一个Nuxt3全栈项目，不得不说，坑很多！！还好最后成功打包上线。下面是记录一下项目部署总结\"><a href=\"#最近在开发一个Nuxt3全栈项目，不得不说，坑很多！！还好最后成功打包上线。下面是记录一下项目部署总结\" class=\"headerlink\" title=\"最近在开发一个Nuxt3全栈项目，不得不说，坑很多！！还好最后成功打包上线。下面是记录一下项目部署总结\"></a>最近在开发一个Nuxt3全栈项目，不得不说，坑很多！！还好最后成功打包上线。下面是记录一下项目部署总结</h2><span id=\"more\"></span>\n\n<h2 id=\"1、-配置服务器环境\"><a href=\"#1、-配置服务器环境\" class=\"headerlink\" title=\"1、 配置服务器环境\"></a>1、 配置服务器环境</h2><p>我的项目数据库使用的MongoDB，所以先安装 mongodb 、nodejs、NoSQLBooster for MongoDB </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//1.安装mongodb之后需要在c盘新建data目录，data目录下新建db目录，配置mondodb的系统环境变量</span><br><span class=\"line\">//2.启动mongodb服务器：mongod</span><br><span class=\"line\">//3.导入mongo数据文件:</span><br><span class=\"line\">mongoimport -d student -c categories category.dat</span><br><span class=\"line\">mongoimport -d student -c cities cities.dat</span><br><span class=\"line\">mongoimport -d student -c artistics artistic.dat</span><br><span class=\"line\">mongoimport -d student -c menus menus.dat</span><br><span class=\"line\">mongoimport -d student -c pois pois.dat</span><br><span class=\"line\">mongoimport -d student -c provinces provinces.dat</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-、将写好的后台文件拷贝到服务器\"><a href=\"#2-、将写好的后台文件拷贝到服务器\" class=\"headerlink\" title=\"2 、将写好的后台文件拷贝到服务器\"></a>2 、将写好的后台文件拷贝到服务器</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//启动node服务器</span></span><br><span class=\"line\">node index.js</span><br><span class=\"line\"><span class=\"comment\">//测试接口</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//110.42.202.216:9988/search/resultsByKeywords</span></span><br><span class=\"line\"><span class=\"comment\">//配置跨域</span></span><br><span class=\"line\">app.all(<span class=\"string\">&#x27;/*&#x27;</span>, <span class=\"function\">(<span class=\"params\">req, res, next</span>) =&gt;</span> &#123;</span><br><span class=\"line\">res.header(<span class=\"string\">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class=\"string\">&#x27;http://localhost:3000&#x27;</span>);</span><br><span class=\"line\">res.header(<span class=\"string\">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">res.header(<span class=\"string\">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class=\"string\">&#x27;GET,POST,PUT,DELETE,OPTIONS&#x27;</span>);</span><br><span class=\"line\">res.header(<span class=\"string\">&quot;Access-Control-Allow-Headers&quot;</span>, <span class=\"string\">&quot;Content-Type,Content-Length, Authorization,</span></span><br><span class=\"line\"><span class=\"string\">Accept,X-Requested-With&quot;</span>);</span><br><span class=\"line\">res.header(<span class=\"string\">&quot;Access-Control-Max-Age&quot;</span>, <span class=\"number\">3600</span>)</span><br><span class=\"line\">next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3、-build项目-重点来了！！\"><a href=\"#3、-build项目-重点来了！！\" class=\"headerlink\" title=\"3、 build项目(重点来了！！)\"></a>3、 build项目(重点来了！！)</h2><p><strong>1.修改项目中所有发送请求的接口 （填写全路径）</strong> 比如下面：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> &#123; data &#125; = <span class=\"keyword\">await</span> useFetch(<span class=\"string\">`http://localhost:9998/api/geo/menu`</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (data.value) &#123;</span><br><span class=\"line\">    menu.value = data.value.menu;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>此时不再区分客户端和服务器，因为不管从客户端发出去的请求还是服务器发出去的请求，请求地址都是同一个。而<br>不像开发的时候，通过代理解决跨域造成的客户端和服务器请求地址不一致。</p>\n<p><strong>2.nuxt.config.js中添加 nitro:{} 配置，才能build成功</strong><br><strong>3.yarn build</strong><br><strong>4.在服务器执行命令 yarn start启动项目</strong><br>    4.1 报错 isEC of null<br>           <strong>删掉 .output\\server\\node_modules@vue\\runtime-core\\dist\\runtime-core.cjs.js第5771行相应代码</strong><br>    4.2 <strong>删掉layouts/default.vue，修改每个页面；否则页面没有数据</strong>!!!</p>\n<pre><code><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">     &lt;el-container&gt;</span><br><span class=\"line\">         &lt;el-header height=&quot;197px&quot;&gt;</span><br><span class=\"line\">             &lt;HeadHindex&gt;&lt;/HeadHindex&gt;</span><br><span class=\"line\">         &lt;/el-header&gt;</span><br><span class=\"line\">         &lt;el-main&gt;</span><br><span class=\"line\">               //页面代码</span><br><span class=\"line\">         &lt;/el-main&gt;</span><br><span class=\"line\">         &lt;el-footer height=&quot;100%&quot;&gt;</span><br><span class=\"line\">             &lt;FootFindex&gt;&lt;/FootFindex&gt;</span><br><span class=\"line\">         &lt;/el-footer&gt;</span><br><span class=\"line\">     &lt;/el-container&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br></pre></td></tr></table></figure>\n</code></pre>\n<p>​      4.3 将页面子组件中需要刷新页面就要显示的请求提取到页面组件中</p>\n<p>5.重新build，修改runtime-core.cjs.js，运行</p>\n<p>6.服务器浏览器输入 <a href=\"http://localhost:3000/\">http://localhost:3000</a> 测试访问</p>\n<p><strong>7.解决跨域登录cookie的问题</strong></p>\n<p>​    7.1 服务器cors Origin一定要填具体的地址，不能用<em>，*<em>一定要设置Credentials</em></em><br>​        res.header(‘Access-Control-Allow-Origin’, ‘<a href=\"http://localhost:3000&#39;\">http://localhost:3000&#39;</a>);<br>​        res.header(‘Access-Control-Allow-Credentials’, true);</p>\n<p>​    7.2 客户端登录接口添加配置项：credentials: “include”</p>\n<p>​    7.3 客户端所有使用到req.session的接口都添加 credentials: “include”。 包括获取用户信息、退出登录、<br>创建购物车、生成订单等接口</p>\n<p>8.项目上线</p>\n<p>​    8.1 将server拷贝到云服务器</p>\n<p>​    8.2 修改dbConfig.js dbs: ‘mongodb://127.0.0.1:27017/student’</p>\n<p>​    8.3 启动mongodb，服务器导入数据库文件</p>\n<p>​    8.4 服务器开启9998和3000端口</p>\n<p>​    8.5 把项目请求地址替换为云服务器ip地址，比如：<a href=\"http://mazg.xyz:9998，重新打包\">http://mazg.xyz:9998，重新打包</a></p>\n<p>​    8.6 修改runtime-core.cjs.js和 .output/server/index.mjs，把localhost改为0.0.0.0</p>\n<p>​    8.7 修改node服务器跨域地址<br>​          res.header(‘Access-Control-Allow-Origin’, ‘<a href=\"http://mazg.xyz:3000&#39;\">http://mazg.xyz:3000&#39;</a>);</p>\n<p>​    8.8 本地浏览器通过 <a href=\"http://mazg.xyz:3000/\">http://mazg.xyz:3000/</a> 即可访问网站</p>\n<p><strong>注意：要保证浏览器的访问域名 、 nuxt代码中的请求域名 、 node服务器的Allow-Origin域名完全一致，</strong><br><strong>post请求才能获取正确的数据.</strong></p>\n<p>好了整个流程就是这样了。心累。。。</p>\n","categories":[],"tags":[{"name":"Nuxt3","slug":"Nuxt3","count":1,"path":"api/tags/Nuxt3.json"}]}